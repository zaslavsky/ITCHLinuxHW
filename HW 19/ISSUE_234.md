# Как проявлялась проблема со стороны пользователя

Перестал открываться сайт по адресу  http://18.192.103.67/

## Пример

```
Страница по адресу Http://18.192.103.67/ отдает сообщение:
    18.153.51.162 refused connection
```

# Как и когда обнаружили
19:44 - обратился сотрудник из отдела PM. с жалобой о недоступности ресурса

## Хронология развития событий
```
17:32 - начало инцидента.
19:44 - Обращение пользователя с жалобой
19:50 - анализ ситуации отправка сообщений в чатах.
20:27 - восстановление работоспособности.
20:41 - окончание инцидента.
```

# Затронутые платформы
Вэб сервер: http://18.192.103.67/

# Последствия

Анжела Петровна из отдела PM крайне раздосадованна отсутсвием доступа к вэб странице

# Как починили

Закомментировали некорректную команду в планировщике задач под пользователем `root`:
```
sudo su
crontab -l
#* * * * * tar -czf /var/log/httpd/log_$(date +\%Y\%m\%d).tar.gz -C /var/log/httpd .
```
Отчистили забившееся место на диске по адресу:
`/dev/nvme0n1p1`
Отчистили лог фаил вэб сервиса:
`sudo echo “” > /var/log/httpd/access_log`
Подменили конфигурационный фаил из бэкапа:
```
cp /home/ec2-user/LocalSettings\ \(5\).php
/var/www/html/mediawiki/LocalSettings.php
```
***NOTE**: Фаил в бэкапе был с некоректными параметрами. Исправили параметр
`$wgServer` 
c ~~`"https://18.153.51.162"`~~ на актуальный `"http://18.192.103.67"`*

Перезапуслити вэб сервис: 
`sudo service httpd restart`
Создали скрипт для ротирования логов:
```
#!/bin/bash
LOG_DIR="/var/log"
LOG_FILE="access_log"
BACKUP_DIR="/path/to/backup"
MAX_BACKUPS=3
DATE=$(date +%Y%m%d)
ARCHIVE="$BACKUP_DIR/$LOG_FILE-$DATE.tar.gz"
# Архивируем лог файлы
tar -czf "$ARCHIVE" "$LOG_DIR/$LOG_FILE"
# Удаляем старые архивы
find "$BACKUP_DIR" -type f -name "$LOG_FILE-*.tar.gz" -mtime +3 -exec rm {} \;
```
Прописали наш скрипт в планировщик задач:
```
crontab -e
0 0 * * * /home/ec2-user/backup_logs.sh
```

# Что сделать чтобы проблема не повторилась

Пересмотреть политику прав на сервере для пользователей.
"ROOT" права оставить только "Александру Корбуту" и "Сергею Смирнову".
Если нужно обновить конфиги или добавить скрипт, то обращаемся к вышеуказанным лицам.

Добавить метрику для отслеживания работоспособности ресурса в систему мониторинга Zabbix. Чтобы группа мониторинга реагировала по триггерам а не по звонкам от пользователей.
